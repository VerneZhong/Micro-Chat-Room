<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Micro-WebIM 注册</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<link rel="stylesheet" href="/css/theme.min.css" media="all">
<link rel="stylesheet" href="layui/css/layui.css" media="all">
<script src="layui/layui.js"></script>
<base href="${basePath}">
<script>
    layui.use(['form', 'jquery', 'layer'], function () {
        var form = layui.form;
        var $ = layui.jquery;
        var layer = layui.layer;
        form.verify({
            username: function (value, item) { //value：表单的值、item：表单的DOM对象
                if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                    return '用户名不能有特殊字符';
                }
                if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                    return '用户名首尾不能出现下划线\'_\'';
                }
                if (/^\d+\d+\d$/.test(value)) {
                    return '用户名不能全为数字';
                }
            }
            , pass: [
                /^[\S]{6,12}$/
                , '密码必须6到12位，且不能出现空格'
            ]
        });
        $("#account").change(function(){
            var account = $("#account").val();
            $.ajax({
                type: "get",
                url: "accountExists.do?account=" + account,
                dataType : 'JSON',
                success: function (data) {
                    if (data.data === true) {
                        layer.msg("该用户名已存在!")
                        $("#account").val('');
                    }
                }
            });
        })
        //监听提交
        form.on('submit(formDemo)', function (data) {
            $.ajax({
                type: "post",
                data: JSON.stringify(data.field),
                url: "register.do",
                dataType : 'JSON',
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    if (data.code === 0) {
                        layer.open({
                            type: 0,
                            content: "注册成功跳转登录页面!",
                            closeBtn: 0,
                            time: 2000,
                            end: function () {
                                window.location.href = "login";
                            }
                        });
                    } else {
                        layer.open({
                            type: 0,
                            content: data.msg,
                            time: 2000
                        });
                    }
                }
            });
            return false;
        });
    });
</script>
<body class="d-flex align-items-center bg-auth border-top border-top-2 border-primary" style="display: block;">
<div class="container">
    <div class="row align-items-center">
        <div class="col-12 col-md-6 offset-xl-2 offset-md-1 order-md-2 mb-5 mb-md-0">
            <div class="text-center">
                <img src="/image/happiness.svg" alt="..." class="img-fluid">
            </div>
        </div>
        <div class="col-12 col-md-5 col-xl-4 order-md-1 my-5">
            <h1 class="display-4 text-center mb-3">
                请注册
            </h1>
            <p class="text-muted text-center mb-5">
                欢迎来到 WebIM 聊天室
            </p>
            <form class="layui-form" action="register.json" method="post">
                <div class="form-group">
                    <label>帐号</label>
                    <input id="account" type="text" name="account" required lay-verify="required" class="form-control layui-input"
                           autocomplete="off" placeholder="请输入帐号">
                </div>
                <div class="form-group">
                    <label>昵称</label>
                    <input type="text" name="nickname" required lay-verify="required" class="form-control layui-input"
                           autocomplete="off" placeholder="请输入昵称">
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col">
                            <!-- Label -->
                            <label>密码</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <input type="password" name="password" required lay-verify="pass" placeholder="请输入密码"
                               autocomplete="off" class="form-control layui-input">
                    </div>
                </div>
                <button type="submit" class="btn btn-lg btn-block btn-primary mb-3" lay-submit lay-filter="formDemo">
                    注册
                </button>
                <div class="text-center">
                    <small class="text-muted text-center">
                        已有帐号? <a href="login">登录</a>.
                    </small>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>